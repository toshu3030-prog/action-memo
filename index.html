<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ—¥æ¬¡è¡Œå‹•ãƒ¡ãƒ¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 16px;
    }
    .card {
      max-width: 640px;
      margin: auto;
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }
    h1 {
      font-size: 18px;
      margin-bottom: 12px;
    }
    input, textarea, button {
      width: 100%;
      font-size: 16px;
      margin-bottom: 10px;
    }
    input, textarea {
      box-sizing: border-box;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="date"] {
      min-height: 44px;
    }
    textarea {
      height: 220px;
    }
    button {
      padding: 12px;
      border-radius: 12px;
      border: none;
      background: #007aff;
      color: #fff;
      cursor: pointer;
    }
    .secondary {
      background: #e5e5ea;
      color: #000;
    }
    .info {
      font-size: 13px;
      color: #555;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ“ æ—¥æ¬¡è¡Œå‹•ãƒ¡ãƒ¢</h1>

    <input type="date" id="date">
    <textarea id="content" placeholder="ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã‚’æ›¸ã"></textarea>

    <button onclick="save()">å…±æœ‰ã—ã¦ä¿å­˜</button>
    <button class="secondary" onclick="load()">éå»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€</button>

    <p class="info" id="status">
      â€» ä¿å­˜æ™‚ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã€ã‚’é¸ã³ã€iCloud Drive å†…ã®ä»»æ„ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚<br>
      â€» åŒã˜æ—¥ä»˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ä¿å­˜ã™ã‚‹ã¨ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚v1.1
    </p>

    <input type="file" id="file" accept=".txt" hidden>
  </div>

  <script>
    const dateInput = document.getElementById('date');
    const content = document.getElementById('content');
    const fileInput = document.getElementById('file');
    const status = document.getElementById('status');

    // åˆæœŸè¡¨ç¤ºã¯å½“æ—¥
    dateInput.value = new Date().toISOString().slice(0, 10);

    async function save() {
      if (!content.value.trim()) {
        alert('å†…å®¹ãŒç©ºã§ã™');
        return;
      }

      const file = new File(
        [content.value],
        `${dateInput.value}.txt`,
        { type: 'text/plain' }
      );

      if (navigator.share && navigator.canShare({ files: [file] })) {
        await navigator.share({ files: [file] });
      } else {
        alert('iPhone / iPad / Mac ã® Safari ã§ä½¿ã£ã¦ãã ã•ã„');
      }
    }

    function load() {
      fileInput.value = '';
      fileInput.click();
    }

    fileInput.onchange = () => {
      const file = fileInput.files[0];
      if (!file) return;

      // txtä»¥å¤–ã‚’å¼¾ã
      if (!file.name.endsWith('.txt')) {
        alert('txtãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿èª­ã¿è¾¼ã‚ã¾ã™');
        return;
      }

      // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ—¥ä»˜ã‚’å–å¾—
      const dateFromName = file.name.replace('.txt', '');

      // YYYY-MM-DD å½¢å¼ãƒã‚§ãƒƒã‚¯
      if (/^\d{4}-\d{2}-\d{2}$/.test(dateFromName)) {
        dateInput.value = dateFromName;
      } else {
        alert('ãƒ•ã‚¡ã‚¤ãƒ«åãŒæ—¥ä»˜å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
      }

      const reader = new FileReader();
      reader.onload = () => {
        content.value = reader.result;
        status.textContent = `ğŸ“‚ ${file.name} ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆv1.1ï¼‰`;
      };
      reader.readAsText(file);
    };
  </script>
</body>
</html>
